<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TyVila X & O</title>
<link rel="icon" href="https://www.tyvila.online/cdn/ty.webp">
<style>
  body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(120deg,#ffecd2,#fcb69f); margin:0; padding:0; overflow-x:hidden; }
  header { display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; background: rgba(0,0,0,0.3); color:#fff; }
  header img { height:50px; }
  .container { max-width:1200px; margin:2rem auto; padding:0 2rem; }
  button { padding:10px 20px; margin:5px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
  button:hover { opacity:0.8; }
  .green { background:#28a745; color:#fff; }
  .blue { background:#007bff; color:#fff; }
  .red { background:#dc3545; color:#fff; }
  .card { background:rgba(255,255,255,0.9); padding:1rem; margin:1rem 0; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.2); }
  select { padding:8px 12px; border-radius:5px; }
  #roomsList div { padding:10px; border-bottom:1px solid #ddd; cursor:pointer; }
  #roomsList div:hover { background:#f1f1f1; }
  .hidden { display:none; }
</style>
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const SUPABASE_URL = 'https://wwcedhbbdoyrmquokyjj.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInJlZiI6ImFub24iLCJpYXQiOjE3NTYwMzYyNjUsImV4cCI6MjA3MTYxMjI2NX0.s29eO4ZQ74R6Jktn5zKZ-AiH6_QYC-_9WFqAS_m1kj4';
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let user = null;
let currentRoom = null;
let currentGame = null;
let lang = 'en';

const translations = {
  en: {
    joinGame: 'Join Game',
    createRoom: 'Create Room',
    championship: 'Championship',
    logout: 'Logout',
    publicRooms: 'Public Rooms',
    enterRoom: 'Enter Room ID:',
    privacy: 'Privacy',
    public: 'Public',
    private: 'Private',
    apply: 'Apply',
    trophies: 'Trophies',
    watchTV: 'Watch Live Matches',
    loginGoogle: 'Login with Google'
  },
  af: {
    joinGame: 'Sluit aan by Speletjie',
    createRoom: 'Skep Kamer',
    championship: 'Kampioenskap',
    logout: 'Teken Uit',
    publicRooms: 'Openbare Kamers',
    enterRoom: 'Voer Kamer-ID in:',
    privacy: 'Privaatheid',
    public: 'Openbaar',
    private: 'Privaat',
    apply: 'Aansoek doen',
    trophies: 'Trofeë',
    watchTV: 'Kyk Na Lewendige Wedstryde',
    loginGoogle: 'Teken in met Google'
  },
  zu: {
    joinGame: 'Joyina Umdlalo',
    createRoom: 'Dala Igumbi',
    championship: 'Impi',
    logout: 'Phuma',
    publicRooms: 'Amagumbi Omphakathi',
    enterRoom: 'Faka i-ID Yegumbi:',
    privacy: 'Ubumfihlo',
    public: 'Omphakathi',
    private: 'Ngasese',
    apply: 'Faka Isicelo',
    trophies: 'Izindondo',
    watchTV: 'Bukela Imidlalo Ephilayo',
    loginGoogle: 'Ngena nge-Google'
  },
  fr: {
    joinGame: 'Rejoindre le Jeu',
    createRoom: 'Créer une Salle',
    championship: 'Championnat',
    logout: 'Déconnexion',
    publicRooms: 'Salles Publiques',
    enterRoom: 'Entrez l’ID de la Salle:',
    privacy: 'Confidentialité',
    public: 'Public',
    private: 'Privé',
    apply: 'Postuler',
    trophies: 'Trophées',
    watchTV: 'Regarder les Matches en Direct',
    loginGoogle: 'Connexion avec Google'
  },
  zh: {
    joinGame: '加入游戏',
    createRoom: '创建房间',
    championship: '锦标赛',
    logout: '登出',
    publicRooms: '公开房间',
    enterRoom: '输入房间ID:',
    privacy: '隐私',
    public: '公开',
    private: '私人',
    apply: '申请',
    trophies: '奖杯',
    watchTV: '观看直播比赛',
    loginGoogle: '使用 Google 登录'
  }
};

document.addEventListener('DOMContentLoaded', async () => {
  // LANG SELECT
  document.getElementById('langSelect').addEventListener('change', e=>{
    lang=e.target.value; updateTexts();
  });
  
  // LOGIN
  document.getElementById('loginBtn').addEventListener('click', async()=>{
    const { data, error } = await supabase.auth.signInWithOAuth({ provider:'google' });
    if(error) alert(error.message);
  });
  
  // LOGOUT
  document.getElementById('logoutBtn').addEventListener('click', async()=>{
    await supabase.auth.signOut();
    location.reload();
  });

  supabase.auth.onAuthStateChange(async (event, session) => {
    if(session?.user){
      user = { id: session.user.id, email: session.user.email, name: session.user.user_metadata.full_name, avatar: session.user.user_metadata.avatar_url };
      document.getElementById('loginSection').classList.add('hidden');
      document.getElementById('mainSection').classList.remove('hidden');
      document.getElementById('userName').textContent = user.name;
      document.getElementById('userAvatar').src = user.avatar;
      loadPublicRooms();
    }
  });
});

function updateTexts(){
  for(const key in translations[lang]){
    const el = document.querySelector(`[data-text='${key}']`);
    if(el) el.textContent = translations[lang][key];
  }
}

// Load Public Rooms
async function loadPublicRooms(){
  const { data, error } = await supabase.from('rooms').select('*').eq('privacy','public').eq('status','waiting');
  const list = document.getElementById('roomsList');
  list.innerHTML='';
  if(data.length===0) list.innerHTML=`<div>No rooms available</div>`;
  data.forEach(r=>{
    const div = document.createElement('div');
    div.textContent = r.name;
    div.onclick = ()=>joinRoomPrompt(r.id);
    list.appendChild(div);
  });
}

async function joinRoomPrompt(roomId){
  currentRoom = roomId;
  alert('Joined Room: '+roomId);
  // Redirect to game UI logic here
}
</script>
</head>
<body>
<header>
  <img src="https://www.tyvila.online/cdn/ty.webp" alt="Logo">
  <select id="langSelect">
    <option value="en">English</option>
    <option value="af">Afrikaans</option>
    <option value="zu">Zulu</option>
    <option value="fr">Français</option>
    <option value="zh">中文</option>
  </select>
  <div id="userSection" class="hidden">
    <img id="userAvatar" src="" alt="Avatar" style="height:40px;border-radius:50%;">
    <span id="userName"></span>
    <button class="red" id="logoutBtn" data-text="logout">Logout</button>
  </div>
</header>

<div class="container">
  <div id="loginSection">
    <button class="blue" id="loginBtn" data-text="loginGoogle">Login with Google</button>
  </div>
  
  <div id="mainSection" class="hidden">
    <div class="card">
      <button class="green" data-text="joinGame">Join Game</button>
      <button class="blue" data-text="createRoom">Create Room</button>
      <button class="red" data-text="championship">Championship</button>
      <button class="green" onclick="window.location.href='tv.html'" data-text="watchTV">Watch Live Matches</button>
    </div>

    <div class="card">
      <h3 data-text="publicRooms">Public Rooms</h3>
      <div id="roomsList"></div>
    </div>
  </div>
</div>
</body>
</html>
